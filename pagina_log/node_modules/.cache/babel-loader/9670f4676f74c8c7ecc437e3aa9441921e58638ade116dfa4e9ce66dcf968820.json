{"ast":null,"code":"export class AnimationPlayer {\n  constructor(target) {\n    this.target = target;\n  }\n  prefersReducedMotion() {\n    const query = window.matchMedia('(prefers-reduced-motion: reduce)');\n    return query.matches;\n  }\n  parseKeyframes(keyframes) {\n    return keyframes.map(keyframe => ({\n      ...keyframe,\n      height: keyframe.height === 'auto' ? `${this.target.scrollHeight}px` : keyframe.height\n    }));\n  }\n  async play(animation) {\n    const {\n      steps,\n      options\n    } = animation;\n    return new Promise(resolve => {\n      if ((options === null || options === void 0 ? void 0 : options.duration) === Infinity) {\n        throw new Error('Promise-based animations must be finite.');\n      }\n      const parsedKeyframes = this.parseKeyframes(steps);\n      const animation = this.target.animate(parsedKeyframes, {\n        ...options,\n        duration: this.prefersReducedMotion() ? 0 : options.duration\n      });\n      animation.addEventListener('cancel', resolve, {\n        once: true\n      });\n      animation.addEventListener('finish', resolve, {\n        once: true\n      });\n    });\n  }\n  stopAll() {\n    return Promise.all(this.target.getAnimations().map(animation => {\n      return new Promise(resolve => {\n        const handleAnimationEvent = () => requestAnimationFrame(resolve);\n        animation.addEventListener('cancel', handleAnimationEvent, {\n          once: true\n        });\n        animation.addEventListener('finish', handleAnimationEvent, {\n          once: true\n        });\n        animation.cancel();\n      });\n    }));\n  }\n}","map":{"version":3,"names":["AnimationPlayer","constructor","target","prefersReducedMotion","query","window","matchMedia","matches","parseKeyframes","keyframes","map","keyframe","height","scrollHeight","play","animation","steps","options","Promise","resolve","duration","Infinity","Error","parsedKeyframes","animate","addEventListener","once","stopAll","all","getAnimations","handleAnimationEvent","requestAnimationFrame","cancel"],"sources":["../../src/animations/player.ts"],"sourcesContent":["import { AnimationReferenceMetadata } from './types.js';\n\nexport class AnimationPlayer {\n  private target!: HTMLElement;\n\n  constructor(target: HTMLElement) {\n    this.target = target;\n  }\n\n  private prefersReducedMotion() {\n    const query = window.matchMedia('(prefers-reduced-motion: reduce)');\n    return query.matches;\n  }\n\n  private parseKeyframes(keyframes: Keyframe[]) {\n    return keyframes.map((keyframe) => ({\n      ...keyframe,\n      height:\n        keyframe.height === 'auto'\n          ? `${this.target.scrollHeight}px`\n          : keyframe.height,\n    }));\n  }\n\n  public async play(animation: AnimationReferenceMetadata) {\n    const { steps, options } = animation;\n\n    return new Promise<AnimationPlaybackEvent>((resolve) => {\n      if (options?.duration === Infinity) {\n        throw new Error('Promise-based animations must be finite.');\n      }\n\n      const parsedKeyframes = this.parseKeyframes(steps);\n      const animation = this.target.animate(parsedKeyframes, {\n        ...options,\n        duration: this.prefersReducedMotion() ? 0 : options!.duration,\n      });\n\n      animation.addEventListener('cancel', resolve, { once: true });\n      animation.addEventListener('finish', resolve, { once: true });\n    });\n  }\n\n  public stopAll() {\n    return Promise.all(\n      this.target.getAnimations().map((animation) => {\n        return new Promise((resolve) => {\n          const handleAnimationEvent = () => requestAnimationFrame(resolve);\n\n          animation.addEventListener('cancel', handleAnimationEvent, {\n            once: true,\n          });\n          animation.addEventListener('finish', handleAnimationEvent, {\n            once: true,\n          });\n          animation.cancel();\n        });\n      })\n    );\n  }\n}\n"],"mappings":"AAEA,OAAM,MAAOA,eAAe;EAG1BC,YAAYC,MAAmB;IAC7B,IAAI,CAACA,MAAM,GAAGA,MAAM;EACtB;EAEQC,oBAAoBA,CAAA;IAC1B,MAAMC,KAAK,GAAGC,MAAM,CAACC,UAAU,CAAC,kCAAkC,CAAC;IACnE,OAAOF,KAAK,CAACG,OAAO;EACtB;EAEQC,cAAcA,CAACC,SAAqB;IAC1C,OAAOA,SAAS,CAACC,GAAG,CAAEC,QAAQ,KAAM;MAClC,GAAGA,QAAQ;MACXC,MAAM,EACJD,QAAQ,CAACC,MAAM,KAAK,MAAM,GACtB,GAAG,IAAI,CAACV,MAAM,CAACW,YAAY,IAAI,GAC/BF,QAAQ,CAACC;KAChB,CAAC,CAAC;EACL;EAEO,MAAME,IAAIA,CAACC,SAAqC;IACrD,MAAM;MAAEC,KAAK;MAAEC;IAAO,CAAE,GAAGF,SAAS;IAEpC,OAAO,IAAIG,OAAO,CAA0BC,OAAO,IAAI;MACrD,IAAI,CAAAF,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEG,QAAQ,MAAKC,QAAQ,EAAE;QAClC,MAAM,IAAIC,KAAK,CAAC,0CAA0C,CAAC;;MAG7D,MAAMC,eAAe,GAAG,IAAI,CAACf,cAAc,CAACQ,KAAK,CAAC;MAClD,MAAMD,SAAS,GAAG,IAAI,CAACb,MAAM,CAACsB,OAAO,CAACD,eAAe,EAAE;QACrD,GAAGN,OAAO;QACVG,QAAQ,EAAE,IAAI,CAACjB,oBAAoB,EAAE,GAAG,CAAC,GAAGc,OAAQ,CAACG;OACtD,CAAC;MAEFL,SAAS,CAACU,gBAAgB,CAAC,QAAQ,EAAEN,OAAO,EAAE;QAAEO,IAAI,EAAE;MAAI,CAAE,CAAC;MAC7DX,SAAS,CAACU,gBAAgB,CAAC,QAAQ,EAAEN,OAAO,EAAE;QAAEO,IAAI,EAAE;MAAI,CAAE,CAAC;IAC/D,CAAC,CAAC;EACJ;EAEOC,OAAOA,CAAA;IACZ,OAAOT,OAAO,CAACU,GAAG,CAChB,IAAI,CAAC1B,MAAM,CAAC2B,aAAa,EAAE,CAACnB,GAAG,CAAEK,SAAS,IAAI;MAC5C,OAAO,IAAIG,OAAO,CAAEC,OAAO,IAAI;QAC7B,MAAMW,oBAAoB,GAAGA,CAAA,KAAMC,qBAAqB,CAACZ,OAAO,CAAC;QAEjEJ,SAAS,CAACU,gBAAgB,CAAC,QAAQ,EAAEK,oBAAoB,EAAE;UACzDJ,IAAI,EAAE;SACP,CAAC;QACFX,SAAS,CAACU,gBAAgB,CAAC,QAAQ,EAAEK,oBAAoB,EAAE;UACzDJ,IAAI,EAAE;SACP,CAAC;QACFX,SAAS,CAACiB,MAAM,EAAE;MACpB,CAAC,CAAC;IACJ,CAAC,CAAC,CACH;EACH"},"metadata":{},"sourceType":"module","externalDependencies":[]}