{"ast":null,"code":"import \"core-js/modules/web.dom-exception.stack.js\";\nimport \"core-js/modules/web.structured-clone.js\";\nexport class SelectionController {\n  get data() {\n    return this.host.data;\n  }\n  resetSearchTerm() {\n    this.host.resetSearchTerm();\n  }\n  getValue(items) {\n    return items.map(value => {\n      if (typeof value === 'object' && value !== null) {\n        return this.host.displayKey ? String(value[this.host.displayKey]) : String(value);\n      } else {\n        return String(value);\n      }\n    }).join(', ');\n  }\n  handleChange(detail) {\n    this.host.requestUpdate('value');\n    return this.host.emitEvent('igcChange', {\n      cancelable: true,\n      detail\n    });\n  }\n  getItemsByValueKey(keys) {\n    return keys.map(key => this.data.find(i => i[this.host.valueKey] === key));\n  }\n  selectValueKeys(keys) {\n    if (keys.length === 0) return;\n    this.getItemsByValueKey(keys).forEach(item => {\n      return item && this._selected.add(item);\n    });\n  }\n  deselectValueKeys(keys) {\n    if (keys.length === 0) return;\n    this.getItemsByValueKey(keys).forEach(item => {\n      return item && this._selected.delete(item);\n    });\n  }\n  selectObjects(items) {\n    if (items.length === 0) return;\n    items.forEach(item => {\n      const i = this.data.includes(item);\n      if (i) {\n        this._selected.add(item);\n      }\n    });\n  }\n  deselectObjects(items) {\n    if (items.length === 0) return;\n    items.forEach(item => {\n      const i = this.data.includes(item);\n      if (i) {\n        this._selected.delete(item);\n      }\n    });\n  }\n  selectAll() {\n    this.data.forEach(item => {\n      this._selected.add(item);\n    });\n    this.host.requestUpdate();\n  }\n  deselectAll() {\n    this._selected.clear();\n    this.host.requestUpdate();\n  }\n  async select(items, emit = false) {\n    const {\n      singleSelect\n    } = this.host;\n    if (singleSelect) {\n      this._selected.clear();\n      this.resetSearchTerm();\n    }\n    if (!items || items.length === 0) {\n      !singleSelect && this.selectAll();\n      return;\n    }\n    const _items = singleSelect ? items.slice(0, 1) : items;\n    const values = this.host.valueKey ? this.getItemsByValueKey(_items) : _items;\n    const selected = Array.from(this._selected.values());\n    const payload = [...values, ...selected];\n    if (emit && !this.handleChange({\n      newValue: this.getValue(payload),\n      items: values,\n      type: 'selection'\n    })) {\n      return;\n    }\n    if (this.host.valueKey) {\n      this.selectValueKeys(_items);\n    } else {\n      this.selectObjects(_items);\n    }\n    this.host.requestUpdate();\n  }\n  async deselect(items, emit = false) {\n    const {\n      singleSelect\n    } = this.host;\n    if (!items || items.length === 0) {\n      if (emit && !this.handleChange({\n        newValue: '',\n        items: Array.from(this.selected),\n        type: 'deselection'\n      })) {\n        return;\n      }\n      !singleSelect && this.deselectAll();\n      return;\n    }\n    const _items = this.host.singleSelect ? items.slice(0, 1) : items;\n    const values = this.host.valueKey ? this.getItemsByValueKey(_items) : _items;\n    const selected = Array.from(this._selected.values());\n    const payload = structuredClone(selected);\n    payload.splice(selected.indexOf(values[0]));\n    if (emit && !this.handleChange({\n      newValue: this.getValue(payload),\n      items: values,\n      type: 'deselection'\n    })) {\n      return;\n    }\n    if (this.host.valueKey) {\n      this.deselectValueKeys(_items);\n    } else {\n      this.deselectObjects(_items);\n    }\n    this.host.requestUpdate();\n  }\n  get selected() {\n    return this._selected;\n  }\n  changeSelection(index) {\n    const item = this.data[index];\n    if (this.host.valueKey) {\n      !this.selected.has(item) ? this.select([item[this.host.valueKey]], true) : this.deselect([item[this.host.valueKey]], true);\n    } else {\n      !this.selected.has(item) ? this.select([item], true) : this.deselect([item], true);\n    }\n  }\n  constructor(host) {\n    this.host = host;\n    this._selected = new Set();\n    this.host.addController(this);\n  }\n  hostConnected() {}\n  hostDisconnected() {}\n}","map":{"version":3,"names":["SelectionController","data","host","resetSearchTerm","getValue","items","map","value","displayKey","String","join","handleChange","detail","requestUpdate","emitEvent","cancelable","getItemsByValueKey","keys","key","find","i","valueKey","selectValueKeys","length","forEach","item","_selected","add","deselectValueKeys","delete","selectObjects","includes","deselectObjects","selectAll","deselectAll","clear","select","emit","singleSelect","_items","slice","values","selected","Array","from","payload","newValue","type","deselect","structuredClone","splice","indexOf","changeSelection","index","has","constructor","Set","addController","hostConnected","hostDisconnected"],"sources":["../../../../src/components/combo/controllers/selection.ts"],"sourcesContent":["import { ReactiveController } from 'lit';\nimport { ComboHost, Values, IgcComboChangeEventArgs, Item } from '../types.js';\n\nexport class SelectionController<T extends object>\n  implements ReactiveController\n{\n  private _selected: Set<T> = new Set();\n\n  public get data() {\n    return this.host.data;\n  }\n\n  public resetSearchTerm() {\n    // @ts-expect-error protected access\n    this.host.resetSearchTerm();\n  }\n\n  public getValue(items: T[]) {\n    return items\n      .map((value) => {\n        if (typeof value === 'object' && value !== null) {\n          return this.host.displayKey\n            ? String(value[this.host.displayKey])\n            : String(value);\n        } else {\n          return String(value);\n        }\n      })\n      .join(', ');\n  }\n\n  private handleChange(detail: IgcComboChangeEventArgs) {\n    this.host.requestUpdate('value');\n    return this.host.emitEvent('igcChange', { cancelable: true, detail });\n  }\n\n  private getItemsByValueKey(keys: Values<T>[]) {\n    return keys.map((key) =>\n      this.data.find((i) => i[this.host.valueKey!] === key)\n    );\n  }\n\n  private selectValueKeys(keys: Values<T>[]) {\n    if (keys.length === 0) return;\n\n    this.getItemsByValueKey(keys).forEach((item) => {\n      return item && this._selected.add(item);\n    });\n  }\n\n  private deselectValueKeys(keys: Values<T>[]) {\n    if (keys.length === 0) return;\n\n    this.getItemsByValueKey(keys).forEach((item) => {\n      return item && this._selected.delete(item);\n    });\n  }\n\n  private selectObjects(items: T[]) {\n    if (items.length === 0) return;\n\n    items.forEach((item) => {\n      const i = this.data.includes(item);\n      if (i) {\n        this._selected.add(item);\n      }\n    });\n  }\n\n  private deselectObjects(items: T[]) {\n    if (items.length === 0) return;\n\n    items.forEach((item) => {\n      const i = this.data.includes(item);\n      if (i) {\n        this._selected.delete(item);\n      }\n    });\n  }\n\n  private selectAll() {\n    this.data.forEach((item) => {\n      this._selected.add(item);\n    });\n    this.host.requestUpdate();\n  }\n\n  private deselectAll() {\n    this._selected.clear();\n    this.host.requestUpdate();\n  }\n\n  public async select(items?: Item<T>[], emit = false) {\n    const { singleSelect } = this.host;\n\n    if (singleSelect) {\n      this._selected.clear();\n      this.resetSearchTerm();\n    }\n\n    if (!items || items.length === 0) {\n      !singleSelect && this.selectAll();\n      return;\n    }\n\n    const _items = singleSelect ? items.slice(0, 1) : items;\n\n    const values = this.host.valueKey\n      ? this.getItemsByValueKey(_items as Values<T>[])\n      : _items;\n    const selected = Array.from(this._selected.values());\n    const payload = [...values, ...selected] as T[];\n\n    if (\n      emit &&\n      !this.handleChange({\n        newValue: this.getValue(payload),\n        items: values as T[],\n        type: 'selection',\n      })\n    ) {\n      return;\n    }\n\n    if (this.host.valueKey) {\n      this.selectValueKeys(_items as Values<T>[]);\n    } else {\n      this.selectObjects(_items as T[]);\n    }\n\n    this.host.requestUpdate();\n  }\n\n  public async deselect(items?: Item<T>[], emit = false) {\n    const { singleSelect } = this.host;\n\n    if (!items || items.length === 0) {\n      if (\n        emit &&\n        !this.handleChange({\n          newValue: '',\n          items: Array.from(this.selected),\n          type: 'deselection',\n        })\n      ) {\n        return;\n      }\n\n      !singleSelect && this.deselectAll();\n      return;\n    }\n\n    const _items = this.host.singleSelect ? items.slice(0, 1) : items;\n    const values = this.host.valueKey\n      ? this.getItemsByValueKey(_items as Values<T>[])\n      : _items;\n    const selected = Array.from(this._selected.values());\n    const payload = structuredClone(selected);\n\n    payload.splice(selected.indexOf(values[0] as T));\n\n    if (\n      emit &&\n      !this.handleChange({\n        newValue: this.getValue(payload),\n        items: values as T[],\n        type: 'deselection',\n      })\n    ) {\n      return;\n    }\n\n    if (this.host.valueKey) {\n      this.deselectValueKeys(_items as Values<T>[]);\n    } else {\n      this.deselectObjects(_items as T[]);\n    }\n\n    this.host.requestUpdate();\n  }\n\n  public get selected(): Set<T> {\n    return this._selected;\n  }\n\n  public changeSelection(index: number) {\n    const item = this.data[index];\n\n    if (this.host.valueKey) {\n      !this.selected.has(item)\n        ? this.select([item[this.host.valueKey]], true)\n        : this.deselect([item[this.host.valueKey]], true);\n    } else {\n      !this.selected.has(item)\n        ? this.select([item], true)\n        : this.deselect([item], true);\n    }\n  }\n\n  constructor(protected host: ComboHost<T>) {\n    this.host.addController(this);\n  }\n\n  public hostConnected() {}\n\n  public hostDisconnected() {}\n}\n"],"mappings":";;AAGA,OAAM,MAAOA,mBAAmB;EAK9B,IAAWC,IAAIA,CAAA;IACb,OAAO,IAAI,CAACC,IAAI,CAACD,IAAI;EACvB;EAEOE,eAAeA,CAAA;IAEpB,IAAI,CAACD,IAAI,CAACC,eAAe,EAAE;EAC7B;EAEOC,QAAQA,CAACC,KAAU;IACxB,OAAOA,KAAK,CACTC,GAAG,CAAEC,KAAK,IAAI;MACb,IAAI,OAAOA,KAAK,KAAK,QAAQ,IAAIA,KAAK,KAAK,IAAI,EAAE;QAC/C,OAAO,IAAI,CAACL,IAAI,CAACM,UAAU,GACvBC,MAAM,CAACF,KAAK,CAAC,IAAI,CAACL,IAAI,CAACM,UAAU,CAAC,CAAC,GACnCC,MAAM,CAACF,KAAK,CAAC;OAClB,MAAM;QACL,OAAOE,MAAM,CAACF,KAAK,CAAC;;IAExB,CAAC,CAAC,CACDG,IAAI,CAAC,IAAI,CAAC;EACf;EAEQC,YAAYA,CAACC,MAA+B;IAClD,IAAI,CAACV,IAAI,CAACW,aAAa,CAAC,OAAO,CAAC;IAChC,OAAO,IAAI,CAACX,IAAI,CAACY,SAAS,CAAC,WAAW,EAAE;MAAEC,UAAU,EAAE,IAAI;MAAEH;IAAM,CAAE,CAAC;EACvE;EAEQI,kBAAkBA,CAACC,IAAiB;IAC1C,OAAOA,IAAI,CAACX,GAAG,CAAEY,GAAG,IAClB,IAAI,CAACjB,IAAI,CAACkB,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAAC,IAAI,CAAClB,IAAI,CAACmB,QAAS,CAAC,KAAKH,GAAG,CAAC,CACtD;EACH;EAEQI,eAAeA,CAACL,IAAiB;IACvC,IAAIA,IAAI,CAACM,MAAM,KAAK,CAAC,EAAE;IAEvB,IAAI,CAACP,kBAAkB,CAACC,IAAI,CAAC,CAACO,OAAO,CAAEC,IAAI,IAAI;MAC7C,OAAOA,IAAI,IAAI,IAAI,CAACC,SAAS,CAACC,GAAG,CAACF,IAAI,CAAC;IACzC,CAAC,CAAC;EACJ;EAEQG,iBAAiBA,CAACX,IAAiB;IACzC,IAAIA,IAAI,CAACM,MAAM,KAAK,CAAC,EAAE;IAEvB,IAAI,CAACP,kBAAkB,CAACC,IAAI,CAAC,CAACO,OAAO,CAAEC,IAAI,IAAI;MAC7C,OAAOA,IAAI,IAAI,IAAI,CAACC,SAAS,CAACG,MAAM,CAACJ,IAAI,CAAC;IAC5C,CAAC,CAAC;EACJ;EAEQK,aAAaA,CAACzB,KAAU;IAC9B,IAAIA,KAAK,CAACkB,MAAM,KAAK,CAAC,EAAE;IAExBlB,KAAK,CAACmB,OAAO,CAAEC,IAAI,IAAI;MACrB,MAAML,CAAC,GAAG,IAAI,CAACnB,IAAI,CAAC8B,QAAQ,CAACN,IAAI,CAAC;MAClC,IAAIL,CAAC,EAAE;QACL,IAAI,CAACM,SAAS,CAACC,GAAG,CAACF,IAAI,CAAC;;IAE5B,CAAC,CAAC;EACJ;EAEQO,eAAeA,CAAC3B,KAAU;IAChC,IAAIA,KAAK,CAACkB,MAAM,KAAK,CAAC,EAAE;IAExBlB,KAAK,CAACmB,OAAO,CAAEC,IAAI,IAAI;MACrB,MAAML,CAAC,GAAG,IAAI,CAACnB,IAAI,CAAC8B,QAAQ,CAACN,IAAI,CAAC;MAClC,IAAIL,CAAC,EAAE;QACL,IAAI,CAACM,SAAS,CAACG,MAAM,CAACJ,IAAI,CAAC;;IAE/B,CAAC,CAAC;EACJ;EAEQQ,SAASA,CAAA;IACf,IAAI,CAAChC,IAAI,CAACuB,OAAO,CAAEC,IAAI,IAAI;MACzB,IAAI,CAACC,SAAS,CAACC,GAAG,CAACF,IAAI,CAAC;IAC1B,CAAC,CAAC;IACF,IAAI,CAACvB,IAAI,CAACW,aAAa,EAAE;EAC3B;EAEQqB,WAAWA,CAAA;IACjB,IAAI,CAACR,SAAS,CAACS,KAAK,EAAE;IACtB,IAAI,CAACjC,IAAI,CAACW,aAAa,EAAE;EAC3B;EAEO,MAAMuB,MAAMA,CAAC/B,KAAiB,EAAEgC,IAAI,GAAG,KAAK;IACjD,MAAM;MAAEC;IAAY,CAAE,GAAG,IAAI,CAACpC,IAAI;IAElC,IAAIoC,YAAY,EAAE;MAChB,IAAI,CAACZ,SAAS,CAACS,KAAK,EAAE;MACtB,IAAI,CAAChC,eAAe,EAAE;;IAGxB,IAAI,CAACE,KAAK,IAAIA,KAAK,CAACkB,MAAM,KAAK,CAAC,EAAE;MAChC,CAACe,YAAY,IAAI,IAAI,CAACL,SAAS,EAAE;MACjC;;IAGF,MAAMM,MAAM,GAAGD,YAAY,GAAGjC,KAAK,CAACmC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,GAAGnC,KAAK;IAEvD,MAAMoC,MAAM,GAAG,IAAI,CAACvC,IAAI,CAACmB,QAAQ,GAC7B,IAAI,CAACL,kBAAkB,CAACuB,MAAqB,CAAC,GAC9CA,MAAM;IACV,MAAMG,QAAQ,GAAGC,KAAK,CAACC,IAAI,CAAC,IAAI,CAAClB,SAAS,CAACe,MAAM,EAAE,CAAC;IACpD,MAAMI,OAAO,GAAG,CAAC,GAAGJ,MAAM,EAAE,GAAGC,QAAQ,CAAQ;IAE/C,IACEL,IAAI,IACJ,CAAC,IAAI,CAAC1B,YAAY,CAAC;MACjBmC,QAAQ,EAAE,IAAI,CAAC1C,QAAQ,CAACyC,OAAO,CAAC;MAChCxC,KAAK,EAAEoC,MAAa;MACpBM,IAAI,EAAE;KACP,CAAC,EACF;MACA;;IAGF,IAAI,IAAI,CAAC7C,IAAI,CAACmB,QAAQ,EAAE;MACtB,IAAI,CAACC,eAAe,CAACiB,MAAqB,CAAC;KAC5C,MAAM;MACL,IAAI,CAACT,aAAa,CAACS,MAAa,CAAC;;IAGnC,IAAI,CAACrC,IAAI,CAACW,aAAa,EAAE;EAC3B;EAEO,MAAMmC,QAAQA,CAAC3C,KAAiB,EAAEgC,IAAI,GAAG,KAAK;IACnD,MAAM;MAAEC;IAAY,CAAE,GAAG,IAAI,CAACpC,IAAI;IAElC,IAAI,CAACG,KAAK,IAAIA,KAAK,CAACkB,MAAM,KAAK,CAAC,EAAE;MAChC,IACEc,IAAI,IACJ,CAAC,IAAI,CAAC1B,YAAY,CAAC;QACjBmC,QAAQ,EAAE,EAAE;QACZzC,KAAK,EAAEsC,KAAK,CAACC,IAAI,CAAC,IAAI,CAACF,QAAQ,CAAC;QAChCK,IAAI,EAAE;OACP,CAAC,EACF;QACA;;MAGF,CAACT,YAAY,IAAI,IAAI,CAACJ,WAAW,EAAE;MACnC;;IAGF,MAAMK,MAAM,GAAG,IAAI,CAACrC,IAAI,CAACoC,YAAY,GAAGjC,KAAK,CAACmC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,GAAGnC,KAAK;IACjE,MAAMoC,MAAM,GAAG,IAAI,CAACvC,IAAI,CAACmB,QAAQ,GAC7B,IAAI,CAACL,kBAAkB,CAACuB,MAAqB,CAAC,GAC9CA,MAAM;IACV,MAAMG,QAAQ,GAAGC,KAAK,CAACC,IAAI,CAAC,IAAI,CAAClB,SAAS,CAACe,MAAM,EAAE,CAAC;IACpD,MAAMI,OAAO,GAAGI,eAAe,CAACP,QAAQ,CAAC;IAEzCG,OAAO,CAACK,MAAM,CAACR,QAAQ,CAACS,OAAO,CAACV,MAAM,CAAC,CAAC,CAAM,CAAC,CAAC;IAEhD,IACEJ,IAAI,IACJ,CAAC,IAAI,CAAC1B,YAAY,CAAC;MACjBmC,QAAQ,EAAE,IAAI,CAAC1C,QAAQ,CAACyC,OAAO,CAAC;MAChCxC,KAAK,EAAEoC,MAAa;MACpBM,IAAI,EAAE;KACP,CAAC,EACF;MACA;;IAGF,IAAI,IAAI,CAAC7C,IAAI,CAACmB,QAAQ,EAAE;MACtB,IAAI,CAACO,iBAAiB,CAACW,MAAqB,CAAC;KAC9C,MAAM;MACL,IAAI,CAACP,eAAe,CAACO,MAAa,CAAC;;IAGrC,IAAI,CAACrC,IAAI,CAACW,aAAa,EAAE;EAC3B;EAEA,IAAW6B,QAAQA,CAAA;IACjB,OAAO,IAAI,CAAChB,SAAS;EACvB;EAEO0B,eAAeA,CAACC,KAAa;IAClC,MAAM5B,IAAI,GAAG,IAAI,CAACxB,IAAI,CAACoD,KAAK,CAAC;IAE7B,IAAI,IAAI,CAACnD,IAAI,CAACmB,QAAQ,EAAE;MACtB,CAAC,IAAI,CAACqB,QAAQ,CAACY,GAAG,CAAC7B,IAAI,CAAC,GACpB,IAAI,CAACW,MAAM,CAAC,CAACX,IAAI,CAAC,IAAI,CAACvB,IAAI,CAACmB,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,GAC7C,IAAI,CAAC2B,QAAQ,CAAC,CAACvB,IAAI,CAAC,IAAI,CAACvB,IAAI,CAACmB,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC;KACpD,MAAM;MACL,CAAC,IAAI,CAACqB,QAAQ,CAACY,GAAG,CAAC7B,IAAI,CAAC,GACpB,IAAI,CAACW,MAAM,CAAC,CAACX,IAAI,CAAC,EAAE,IAAI,CAAC,GACzB,IAAI,CAACuB,QAAQ,CAAC,CAACvB,IAAI,CAAC,EAAE,IAAI,CAAC;;EAEnC;EAEA8B,YAAsBrD,IAAkB;IAAlB,KAAAA,IAAI,GAAJA,IAAI;IAjMlB,KAAAwB,SAAS,GAAW,IAAI8B,GAAG,EAAE;IAkMnC,IAAI,CAACtD,IAAI,CAACuD,aAAa,CAAC,IAAI,CAAC;EAC/B;EAEOC,aAAaA,CAAA,GAAI;EAEjBC,gBAAgBA,CAAA,GAAI"},"metadata":{},"sourceType":"module","externalDependencies":[]}