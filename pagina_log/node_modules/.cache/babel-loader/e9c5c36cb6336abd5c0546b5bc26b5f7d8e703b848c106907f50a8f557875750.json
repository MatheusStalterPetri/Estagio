{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nimport { html } from 'lit';\nimport { directive, PartType } from 'lit/directive.js';\nimport { AsyncDirective } from 'lit/async-directive.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { Virtualizer } from './Virtualizer.js';\nexport { virtualizerRef } from './Virtualizer.js';\nexport const defaultKeyFunction = item => item;\nexport const defaultRenderItem = (item, idx) => html`${idx}: ${JSON.stringify(item, null, 2)}`;\nclass VirtualizeDirective extends AsyncDirective {\n  constructor(part) {\n    super(part);\n    this._virtualizer = null;\n    this._first = 0;\n    this._last = -1;\n    this._renderItem = (item, idx) => defaultRenderItem(item, idx + this._first);\n    this._keyFunction = (item, idx) => defaultKeyFunction(item, idx + this._first);\n    this._items = [];\n    if (part.type !== PartType.CHILD) {\n      throw new Error('The virtualize directive can only be used in child expressions');\n    }\n  }\n  render(config) {\n    if (config) {\n      this._setFunctions(config);\n    }\n    const itemsToRender = [];\n    // TODO (graynorton): Is this the best / only place to ensure\n    // that _last isn't outside the current bounds of the items array?\n    // Not sure we should ever arrive here with it out of bounds.\n    // Repro case for original issue: https://tinyurl.com/yes8b2e6\n    const lastItem = Math.min(this._items.length, this._last + 1);\n    if (this._first >= 0 && this._last >= this._first) {\n      for (let i = this._first; i < lastItem; i++) {\n        itemsToRender.push(this._items[i]);\n      }\n    }\n    return repeat(itemsToRender, this._keyFunction, this._renderItem);\n  }\n  update(part, [config]) {\n    this._setFunctions(config);\n    this._items = config.items || [];\n    if (this._virtualizer) {\n      this._updateVirtualizerConfig(part, config);\n    } else {\n      this._initialize(part, config);\n    }\n    return this.render();\n  }\n  _updateVirtualizerConfig(part, config) {\n    const compatible = this._virtualizer.updateLayoutConfig(config.layout || {});\n    if (!compatible) {\n      const hostElement = part.parentNode;\n      this._makeVirtualizer(hostElement, config);\n    }\n    this._virtualizer.items = this._items;\n  }\n  _setFunctions(config) {\n    const {\n      renderItem,\n      keyFunction\n    } = config;\n    if (renderItem) {\n      this._renderItem = (item, idx) => renderItem(item, idx + this._first);\n    }\n    if (keyFunction) {\n      this._keyFunction = (item, idx) => keyFunction(item, idx + this._first);\n    }\n  }\n  _makeVirtualizer(hostElement, config) {\n    if (this._virtualizer) {\n      this._virtualizer.disconnected();\n    }\n    const {\n      layout,\n      scroller,\n      items\n    } = config;\n    this._virtualizer = new Virtualizer({\n      hostElement,\n      layout,\n      scroller\n    });\n    this._virtualizer.items = items;\n    this._virtualizer.connected();\n  }\n  _initialize(part, config) {\n    const hostElement = part.parentNode;\n    if (hostElement && hostElement.nodeType === 1) {\n      hostElement.addEventListener('rangeChanged', e => {\n        e.stopPropagation();\n        this._first = e.first;\n        this._last = e.last;\n        this.setValue(this.render());\n      });\n      this._makeVirtualizer(hostElement, config);\n    }\n  }\n  disconnected() {\n    var _a;\n    (_a = this._virtualizer) === null || _a === void 0 ? void 0 : _a.disconnected();\n  }\n  reconnected() {\n    var _a;\n    (_a = this._virtualizer) === null || _a === void 0 ? void 0 : _a.connected();\n  }\n}\nexport const virtualize = directive(VirtualizeDirective);","map":{"version":3,"names":["html","directive","PartType","AsyncDirective","repeat","Virtualizer","virtualizerRef","defaultKeyFunction","item","defaultRenderItem","idx","JSON","stringify","VirtualizeDirective","constructor","part","_virtualizer","_first","_last","_renderItem","_keyFunction","_items","type","CHILD","Error","render","config","_setFunctions","itemsToRender","lastItem","Math","min","length","i","push","update","items","_updateVirtualizerConfig","_initialize","compatible","updateLayoutConfig","layout","hostElement","parentNode","_makeVirtualizer","renderItem","keyFunction","disconnected","scroller","connected","nodeType","addEventListener","e","stopPropagation","first","last","setValue","_a","reconnected","virtualize"],"sources":["src/virtualize.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport {TemplateResult, ChildPart, html} from 'lit';\nimport {directive, DirectiveResult, PartInfo, PartType} from 'lit/directive.js';\nimport {AsyncDirective} from 'lit/async-directive.js';\nimport {repeat, KeyFn} from 'lit/directives/repeat.js';\nimport {Virtualizer} from './Virtualizer.js';\nimport {RangeChangedEvent} from './events.js';\nimport {LayoutConfigValue} from './layouts/shared/Layout.js';\n\nexport {virtualizerRef, VirtualizerHostElement} from './Virtualizer.js';\n\n/**\n * Configuration options for the virtualize directive.\n */\nexport interface VirtualizeDirectiveConfig<T> {\n  /**\n   * A function that returns a lit-html TemplateResult. It will be used\n   * to generate the DOM for each item in the virtual list.\n   */\n  renderItem?: RenderItemFunction<T>;\n\n  keyFunction?: KeyFn<T>;\n\n  scroller?: boolean;\n\n  // TODO (graynorton): Document...\n  layout?: LayoutConfigValue;\n\n  /**\n   * The list of items to display via the renderItem function.\n   */\n  items?: Array<T>;\n}\n\nexport type RenderItemFunction<T = unknown> = (\n  item: T,\n  index: number\n) => TemplateResult;\n\nexport const defaultKeyFunction: KeyFn<unknown> = (item: unknown) => item;\nexport const defaultRenderItem: RenderItemFunction<unknown> = (\n  item: unknown,\n  idx: number\n) => html`${idx}: ${JSON.stringify(item, null, 2)}`;\n\nclass VirtualizeDirective<T = unknown> extends AsyncDirective {\n  _virtualizer: Virtualizer | null = null;\n  _first = 0;\n  _last = -1;\n  _renderItem: RenderItemFunction<T> = (item: T, idx: number) =>\n    defaultRenderItem(item, idx + this._first);\n  _keyFunction: KeyFn<T> = (item: T, idx: number) =>\n    defaultKeyFunction(item, idx + this._first);\n  _items: Array<T> = [];\n\n  constructor(part: PartInfo) {\n    super(part);\n    if (part.type !== PartType.CHILD) {\n      throw new Error(\n        'The virtualize directive can only be used in child expressions'\n      );\n    }\n  }\n\n  render(config?: VirtualizeDirectiveConfig<T>) {\n    if (config) {\n      this._setFunctions(config);\n    }\n    const itemsToRender: Array<T> = [];\n    // TODO (graynorton): Is this the best / only place to ensure\n    // that _last isn't outside the current bounds of the items array?\n    // Not sure we should ever arrive here with it out of bounds.\n    // Repro case for original issue: https://tinyurl.com/yes8b2e6\n    const lastItem = Math.min(this._items.length, this._last + 1);\n\n    if (this._first >= 0 && this._last >= this._first) {\n      for (let i = this._first; i < lastItem; i++) {\n        itemsToRender.push(this._items[i]);\n      }\n    }\n    return repeat(itemsToRender, this._keyFunction, this._renderItem);\n  }\n\n  update(part: ChildPart, [config]: [VirtualizeDirectiveConfig<T>]) {\n    this._setFunctions(config);\n    this._items = config.items || [];\n    if (this._virtualizer) {\n      this._updateVirtualizerConfig(part, config);\n    } else {\n      this._initialize(part, config);\n    }\n    return this.render();\n  }\n\n  private _updateVirtualizerConfig(\n    part: ChildPart,\n    config: VirtualizeDirectiveConfig<T>\n  ) {\n    const compatible = this._virtualizer!.updateLayoutConfig(\n      config.layout || {}\n    );\n    if (!compatible) {\n      const hostElement = part.parentNode as HTMLElement;\n      this._makeVirtualizer(hostElement, config);\n    }\n    this._virtualizer!.items = this._items;\n  }\n\n  private _setFunctions(config: VirtualizeDirectiveConfig<T>) {\n    const {renderItem, keyFunction} = config;\n    if (renderItem) {\n      this._renderItem = (item, idx) => renderItem(item, idx + this._first);\n    }\n    if (keyFunction) {\n      this._keyFunction = (item, idx) => keyFunction(item, idx + this._first);\n    }\n  }\n\n  private _makeVirtualizer(\n    hostElement: HTMLElement,\n    config: VirtualizeDirectiveConfig<T>\n  ) {\n    if (this._virtualizer) {\n      this._virtualizer.disconnected();\n    }\n    const {layout, scroller, items} = config;\n    this._virtualizer = new Virtualizer({hostElement, layout, scroller});\n    this._virtualizer.items = items;\n    this._virtualizer!.connected();\n  }\n\n  private _initialize(part: ChildPart, config: VirtualizeDirectiveConfig<T>) {\n    const hostElement = part.parentNode as HTMLElement;\n    if (hostElement && hostElement.nodeType === 1) {\n      hostElement.addEventListener('rangeChanged', (e: RangeChangedEvent) => {\n        e.stopPropagation();\n        this._first = e.first;\n        this._last = e.last;\n        this.setValue(this.render());\n      });\n      this._makeVirtualizer(hostElement, config);\n    }\n  }\n\n  disconnected() {\n    this._virtualizer?.disconnected();\n  }\n\n  reconnected() {\n    this._virtualizer?.connected();\n  }\n}\n\nexport const virtualize = directive(VirtualizeDirective) as <T>(\n  config?: VirtualizeDirectiveConfig<T>\n) => DirectiveResult<typeof VirtualizeDirective>;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}