{"ast":null,"code":"var __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _SortController_instances, _SortController_isMultipleSort_get, _SortController_isTriStateSort_get, _SortController_resolveSortOptions, _SortController_createDefaultExpression, _SortController_orderBy, _SortController_emitSortingEvent, _SortController_emitSortedEvent, _SortController_setExpression;\nimport { PIPELINE } from '../internal/constants.js';\nimport { asArray } from '../internal/utils.js';\nexport class SortController {\n  constructor(host) {\n    this.host = host;\n    _SortController_instances.add(this);\n    this.state = new Map();\n    this.host.addController(this);\n  }\n  async sortFromHeaderClick(column) {\n    const expression = this.prepareExpression(column);\n    if (!__classPrivateFieldGet(this, _SortController_instances, \"m\", _SortController_emitSortingEvent).call(this, expression)) {\n      return;\n    }\n    if (!__classPrivateFieldGet(this, _SortController_instances, \"a\", _SortController_isMultipleSort_get)) {\n      this.reset();\n    }\n    this._sort(expression);\n    await this.host.updateComplete;\n    __classPrivateFieldGet(this, _SortController_instances, \"m\", _SortController_emitSortedEvent).call(this, expression);\n  }\n  prepareExpression({\n    key,\n    sort: options\n  }) {\n    if (this.state.has(key)) {\n      const expr = this.state.get(key);\n      return Object.assign(expr, {\n        direction: __classPrivateFieldGet(this, _SortController_instances, \"m\", _SortController_orderBy).call(this, expr.direction),\n        ...__classPrivateFieldGet(this, _SortController_instances, \"m\", _SortController_resolveSortOptions).call(this, options)\n      });\n    }\n    // Initial state\n    return __classPrivateFieldGet(this, _SortController_instances, \"m\", _SortController_createDefaultExpression).call(this, key);\n  }\n  reset(key) {\n    key ? this.state.delete(key) : this.state.clear();\n  }\n  _sort(expressions) {\n    asArray(expressions).forEach(expr => __classPrivateFieldGet(this, _SortController_instances, \"m\", _SortController_setExpression).call(this, expr));\n    this.host.requestUpdate(PIPELINE);\n  }\n  sort(expressions) {\n    this._sort(asArray(expressions).map(expr => {\n      var _a;\n      return Object.assign((_a = this.state.get(expr.key)) !== null && _a !== void 0 ? _a : __classPrivateFieldGet(this, _SortController_instances, \"m\", _SortController_createDefaultExpression).call(this, expr.key), expr);\n    }));\n  }\n  hostConnected() {}\n}\n_SortController_instances = new WeakSet(), _SortController_isMultipleSort_get = function _SortController_isMultipleSort_get() {\n  return this.host.sortConfiguration.multiple;\n}, _SortController_isTriStateSort_get = function _SortController_isTriStateSort_get() {\n  return this.host.sortConfiguration.triState;\n}, _SortController_resolveSortOptions = function _SortController_resolveSortOptions(options) {\n  const expr = {\n    caseSensitive: false,\n    comparer: undefined\n  };\n  if (!options || typeof options === 'boolean') {\n    return expr;\n  }\n  return Object.assign(expr, {\n    caseSensitive: options.caseSensitive,\n    comparer: options.comparer\n  });\n}, _SortController_createDefaultExpression = function _SortController_createDefaultExpression(key) {\n  var _a;\n  const options = (_a = this.host.getColumn(key)) === null || _a === void 0 ? void 0 : _a.sort;\n  return {\n    key,\n    direction: 'ascending',\n    ...__classPrivateFieldGet(this, _SortController_instances, \"m\", _SortController_resolveSortOptions).call(this, options)\n  };\n}, _SortController_orderBy = function _SortController_orderBy(dir) {\n  return __classPrivateFieldGet(this, _SortController_instances, \"a\", _SortController_isTriStateSort_get) ? dir === 'ascending' ? 'descending' : dir === 'descending' ? 'none' : 'ascending' : dir === 'ascending' ? 'descending' : 'ascending';\n}, _SortController_emitSortingEvent = function _SortController_emitSortingEvent(detail) {\n  return this.host.emitEvent('sorting', {\n    detail,\n    cancelable: true\n  });\n}, _SortController_emitSortedEvent = function _SortController_emitSortedEvent(detail) {\n  return this.host.emitEvent('sorted', {\n    detail\n  });\n}, _SortController_setExpression = function _SortController_setExpression(expression) {\n  expression.direction === 'none' ? this.reset(expression.key) : this.state.set(expression.key, {\n    ...expression\n  });\n};","map":{"version":3,"names":["PIPELINE","asArray","SortController","constructor","host","state","Map","addController","sortFromHeaderClick","column","expression","prepareExpression","__classPrivateFieldGet","_SortController_instances","_SortController_emitSortingEvent","call","_SortController_isMultipleSort_get","reset","_sort","updateComplete","_SortController_emitSortedEvent","key","sort","options","has","expr","get","Object","assign","direction","_SortController_orderBy","_SortController_resolveSortOptions","_SortController_createDefaultExpression","delete","clear","expressions","forEach","_SortController_setExpression","requestUpdate","map","_a","hostConnected","sortConfiguration","multiple","_SortController_isTriStateSort_get","triState","caseSensitive","comparer","undefined","getColumn","dir","detail","emitEvent","cancelable","set"],"sources":["../../../src/controllers/sort.ts"],"sourcesContent":["import { ReactiveController } from 'lit';\nimport { PIPELINE } from '../internal/constants.js';\nimport { asArray } from '../internal/utils.js';\nimport type {\n  ColumnConfiguration,\n  ColumnSortConfiguration,\n  GridHost,\n  Keys,\n} from '../internal/types.js';\nimport type { SortExpression, SortingDirection, SortState } from '../operations/sort/types.js';\n\nexport class SortController<T extends object> implements ReactiveController {\n  constructor(protected host: GridHost<T>) {\n    this.host.addController(this);\n  }\n\n  public state: SortState<T> = new Map();\n\n  get #isMultipleSort() {\n    return this.host.sortConfiguration.multiple;\n  }\n\n  get #isTriStateSort() {\n    return this.host.sortConfiguration.triState;\n  }\n\n  #resolveSortOptions(options?: boolean | ColumnSortConfiguration<T>) {\n    const expr: Pick<SortExpression<T>, 'caseSensitive' | 'comparer'> = {\n      caseSensitive: false,\n      comparer: undefined,\n    };\n\n    if (!options || typeof options === 'boolean') {\n      return expr as Partial<SortExpression<T>>;\n    }\n\n    return Object.assign(expr, {\n      caseSensitive: options.caseSensitive,\n      comparer: options.comparer,\n    }) as Partial<SortExpression<T>>;\n  }\n\n  #createDefaultExpression(key: Keys<T>) {\n    const options = this.host.getColumn(key)?.sort;\n\n    return {\n      key,\n      direction: 'ascending',\n      ...this.#resolveSortOptions(options),\n    } as SortExpression<T>;\n  }\n\n  #orderBy(dir?: SortingDirection): SortingDirection {\n    return this.#isTriStateSort\n      ? dir === 'ascending'\n        ? 'descending'\n        : dir === 'descending'\n        ? 'none'\n        : 'ascending'\n      : dir === 'ascending'\n      ? 'descending'\n      : 'ascending';\n  }\n\n  #emitSortingEvent(detail: SortExpression<T>) {\n    return this.host.emitEvent('sorting', { detail, cancelable: true });\n  }\n\n  #emitSortedEvent(detail: SortExpression<T>) {\n    return this.host.emitEvent('sorted', { detail });\n  }\n\n  #setExpression(expression: SortExpression<T>) {\n    expression.direction === 'none'\n      ? this.reset(expression.key)\n      : this.state.set(expression.key, { ...expression });\n  }\n\n  public async sortFromHeaderClick(column: ColumnConfiguration<T>) {\n    const expression = this.prepareExpression(column);\n\n    if (!this.#emitSortingEvent(expression)) {\n      return;\n    }\n\n    if (!this.#isMultipleSort) {\n      this.reset();\n    }\n\n    this._sort(expression);\n\n    await this.host.updateComplete;\n    this.#emitSortedEvent(expression);\n  }\n\n  public prepareExpression({ key, sort: options }: ColumnConfiguration<T>): SortExpression<T> {\n    if (this.state.has(key)) {\n      const expr = this.state.get(key)!;\n\n      return Object.assign(expr, {\n        direction: this.#orderBy(expr.direction),\n        ...this.#resolveSortOptions(options),\n      });\n    }\n\n    // Initial state\n    return this.#createDefaultExpression(key);\n  }\n\n  public reset(key?: Keys<T>) {\n    key ? this.state.delete(key) : this.state.clear();\n  }\n\n  protected _sort(expressions: SortExpression<T> | SortExpression<T>[]) {\n    asArray(expressions).forEach(expr => this.#setExpression(expr));\n    this.host.requestUpdate(PIPELINE);\n  }\n\n  public sort(expressions: SortExpression<T> | SortExpression<T>[]) {\n    this._sort(\n      asArray(expressions).map(expr =>\n        Object.assign(this.state.get(expr.key) ?? this.#createDefaultExpression(expr.key), expr),\n      ),\n    );\n  }\n\n  public hostConnected() {}\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}